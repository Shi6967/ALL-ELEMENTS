-- Example_AllElements_FromURL.lua
-- Loads the UI library from the provided URL and demonstrates every element.
-- Place this as a LocalScript (StarterPlayerScripts) or execute in a local environment.

local LIB_URL = "https://raw.githubusercontent.com/Shi6967/Ad-Link/refs/heads/main/Link"

local ok, a, b, c = pcall(function()
	local source = game:HttpGet(LIB_URL)
	local fn = loadstring(source)
	return fn()
end)

local Library, SaveManager, InterfaceManager

if ok then
	Library, SaveManager, InterfaceManager = a, b, c
else
	if getgenv and getgenv().Fluent then
		Library = getgenv().Fluent
		warn("Loaded library from getgenv().Fluent as fallback.")
	else
		error("Failed to load UI library from URL: " .. tostring(a))
	end
end

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Stats = game:GetService("Stats")
local LocalPlayer = Players.LocalPlayer

local PET_NAME = "Swift Samurai"
local ROCK_NAME = "Rock5M"
local PROTEIN_EGG_NAME = "ProteinEgg"
local PROTEIN_EGG_INTERVAL = 30 * 60
local REPS_PER_CYCLE = 180
local REP_DELAY = 0.003
local ROCK_INTERVAL = 1
local MAX_PING = 1100

local HumanoidRootPart
local lastProteinEggTime = 0
local lastRockTime = 0
local RockRef = workspace:FindFirstChild(ROCK_NAME)

local function getPing()
	local success, ping = pcall(function()
		return Stats.Network.ServerStatsItem["Data Ping"]:GetValue()
	end)
	return success and ping or 999
end

local function updateCharacterRefs()
	local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	HumanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
end

local function equipPet()
	local petsFolder = LocalPlayer:FindFirstChild("petsFolder")
	if petsFolder and petsFolder:FindFirstChild("Unique") then
		for _, pet in pairs(petsFolder.Unique:GetChildren()) do
			if pet.Name == PET_NAME then
				ReplicatedStorage.rEvents.equipPetEvent:FireServer("equipPet", pet)
				break
			end
		end
	end
end

local function eatProteinEgg()
	if LocalPlayer:FindFirstChild("Backpack") then
		for _, item in pairs(LocalPlayer.Backpack:GetChildren()) do
			if item.Name == PROTEIN_EGG_NAME then
				ReplicatedStorage.rEvents.eatEvent:FireServer("eat", item)
				break
			end
		end
	end
end

local function hitRock()
	if not RockRef or not RockRef.Parent then
		RockRef = workspace:FindFirstChild(ROCK_NAME)
	end
	if RockRef and HumanoidRootPart then
		HumanoidRootPart.CFrame = RockRef.CFrame * CFrame.new(0, 0, -5)
		ReplicatedStorage.rEvents.hitEvent:FireServer("hit", RockRef)
	end
end

if not getgenv()._AutoRepFarmLoop then
    getgenv()._AutoRepFarmLoop = true

    task.spawn(function()
        updateCharacterRefs()
        equipPet()
        lastProteinEggTime = tick()
        lastRockTime = tick()

        while true do
            if getgenv()._AutoRepFarmEnabled then
                local ping = getPing()
                if ping > MAX_PING then
                    warn("[Auto Rep Farm] Ping alto ("..math.floor(ping).."ms), pausing for 5s...")
                    task.wait(5)
                else
                    if LocalPlayer:FindFirstChild("muscleEvent") then
                        for i = 1, REPS_PER_CYCLE do
                            LocalPlayer.muscleEvent:FireServer("rep")
                            task.wait(REP_DELAY)
                        end
                    end
                    
                    if tick() - lastProteinEggTime >= PROTEIN_EGG_INTERVAL then
                        eatProteinEgg()
                        lastProteinEggTime = tick()
                    end

                    if tick() - lastRockTime >= ROCK_INTERVAL then
                        hitRock()
                        lastRockTime = tick()
                    end
                    
                end
            else
                task.wait(1)
            end
        end
    end)
end

local Window = Library:CreateWindow({
	Title = "SAILYNxSHI AutoFarm",
	SubTitle = "Strength Grinder",
	Size = UDim2.fromOffset(500, 335),
	TabWidth = 150,
	Theme = "SpeedHubX",
	Acrylic = false,
})

local autoFarmTab = Window:AddTab({ Title = "Farm OP", Icon = "flame" })
local farmSection = autoFarmTab:AddSection("Fuerza OP")

farmSection:AddToggle("OP_STRENGTH_TOGGLE", {
	Title = "OP STRENGTH",
	Description = "Activates the strength auto-farm. (OP Strength)",
	Default = false,
	Callback = function(state)
		getgenv()._AutoRepFarmEnabled = state
		warn("[Auto Rep Farm] Status changed to:", state and "ON" or "OFF")
	end,
})

Library:Notify({
	Title = "AutoFarm Loaded",
	Content = "Strength Grinder UI is ready. Activate 'OP STRENGTH' to start.",
	Duration = 6,
})

Window:SelectTab(1)
